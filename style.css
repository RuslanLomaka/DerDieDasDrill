/* --- GLOBAL RESET & VARIABLES --- */
:root {
    --bg: #0b1020;
    --card: #12192d;
    --muted: #a0aec0;
    --text: #e7ecff;
    --ok: #36c689;
    --bad: #ff6470;
    --der: #4b8bff;
    --die: #ff6cae;
    --das: #ffd84b;
    --border: #24335c;
    --accent: #a3a9ff;

    --col-w: 520px;
    --stage-w: 380px;

    /* slot Y positions (overridden by JS for perfect clipping safety) */
    --y-next: 20px;
    --y-active: 170px;
    --y-prev: 330px;
    --y-exit: 520px;
}

* { box-sizing: border-box; }
html, body { height: 100%; }

body{
    margin:0;
    font-family: system-ui, -apple-system, sans-serif;
    background: radial-gradient(circle at top, #161d33 0%, #0b1020 100%);
    color: var(--text);

    min-height: 100svh;
    height: 100dvh;

    width: 100vw;
    display: flex;
    flex-direction: column;

    overflow-x: hidden;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

/* --- HEADER --- */
header{
    width:100%;
    padding:8px 15px 10px;
    padding-top:max(8px, env(safe-area-inset-top));
    display:flex;
    justify-content:space-between;
    align-items:center;
    background: rgba(11,16,32,0.95);
    border-bottom: 1px solid var(--border);
    z-index:10;
}

.header-row{
    width:100%;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
}

.controls-top{
    display:flex;
    align-items:center;
    gap:10px;
}

.credits-top{
    font-size:11px;
    color: rgba(231,236,255,0.65);
    display:flex;
    align-items:center;
    gap:8px;
    white-space:nowrap;
    line-height:1;
}
.credits-top a{
    color: rgba(163,169,255,0.9);
    text-decoration:none;
}
.credits-top a:hover{ text-decoration:underline; }

.pill{
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text);
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 12px;
    cursor: pointer;
}

/* --- LEVEL CHIPS --- */
.level-chips{ display:inline-flex; gap:6px; align-items:center; flex-wrap:nowrap; }
.chip{
    background: rgba(26,35,64,0.55);
    border: 1px solid rgba(36,51,92,0.95);
    color: rgba(231,236,255,0.85);
    padding:6px 10px;
    border-radius:999px;
    font-size:12px;
    font-weight:800;
    letter-spacing:0.02em;
    cursor:pointer;
    user-select:none;
    -webkit-tap-highlight-color: transparent;
    transition: transform 120ms ease, background 180ms ease, border-color 180ms ease, opacity 180ms ease;
}
.chip:active{ transform: scale(0.98); }
.chip:hover{ border-color: rgba(163,169,255,0.55); }
.chip.active{
    background: rgba(163,169,255,0.18);
    border-color: rgba(163,169,255,0.75);
    color: var(--text);
}

/* --- MAIN --- */
main{
    flex:1;
    width:100%;
    max-width:600px;
    margin:0 auto;
    padding:10px;
    position:relative;

    display:flex;
    flex-direction:column;
    gap:10px;

    padding-bottom: max(14px, env(safe-area-inset-bottom));
}

/* --- HUD --- */
.game-hud{
    display:flex;
    justify-content:space-around;
    align-items:center;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 0 10px;
    height: 50px;
}

.stat-item{ text-align:center; min-width:90px; }
.stat-item .label{
    display:block;
    font-size:9px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
.stat-item .value{ font-size:18px; font-weight:800; }

/* --- STAGE --- */
.stage-wrapper{ display:flex; align-items:center; justify-content:center; }

.stage{
    position:relative;
    width: min(320px, 92vw);
    height: 480px;
    background: #080c18;
    border-radius: 24px;
    border: 3px solid var(--border);
    box-shadow: inset 0 0 60px rgba(0,0,0,0.9);
    overflow:hidden;
}

.stage::before, .stage::after{
    content:"";
    position:absolute;
    left:0; right:0;
    height: 70px;
    z-index:10;
    pointer-events:none;
}
.stage::before{ top:0; background: linear-gradient(to bottom, #080c18 0%, transparent 100%); }
.stage::after{ bottom:0; background: linear-gradient(to top, #080c18 0%, transparent 100%); }

/* language button */
.lang-toggle{
    position:absolute;
    top:10px; left:10px;
    z-index:30;
    width:34px; height:34px;
    border-radius:10px;
    border: 1px solid rgba(36,51,92,0.9);
    background: rgba(18,25,45,0.35);
    color: var(--text);
    display:inline-flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    user-select:none;
    -webkit-tap-highlight-color: transparent;
    transition: opacity 220ms ease, transform 120ms ease, background 220ms ease, border-color 220ms ease;
    font-size:18px;
    line-height:1;
}
.lang-toggle:active{ transform: scale(0.96); }
.lang-toggle.is-dim{ opacity: 0.18; }
.lang-toggle:hover{
    background: rgba(18,25,45,0.55);
    border-color: rgba(163,169,255,0.55);
}

/* --- CONTROLS --- */
.controls-area{
    display:flex;
    gap:8px;
    width:100%;
    height: 90px;
    align-items: stretch;
}

.btn{
    flex:1;
    border-radius:14px;
    border:none;
    font-size:20px;
    font-weight:800;
    color:#fff;
    cursor:pointer;
    box-shadow: 0 4px 0 rgba(0,0,0,0.3);
    transition: transform 0.1s;
    touch-action: manipulation;
}
.btn:active{ transform: translateY(4px); box-shadow:none; }
.btn.der{ background: var(--der); }
.btn.die{ background: var(--die); }
.btn.das{ background: var(--das); }

/* --- SLOT --- */
.reel-container{ position:relative; width:100%; height:100%; }

.slot-unit{
    position:absolute;
    left:0; right:0;
    height:140px;
    display:flex;
    align-items:center;
    justify-content:center;
    transition: all 0.6s cubic-bezier(0.25,1,0.5,1);
    font-weight:800;
    padding: 0 18px;
    text-align:center;
}

/* INNER LAYOUT: center correctly (word-only vs article+word) */
.slot-content{
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    width:100%;
}

.caption-row{
    display:flex;
    align-items:baseline;
    justify-content:center;
    width:100%;
}

/* word + article typography (bigger, still clamps) */
.word-span, .article-reveal{
    display:inline-block;
    white-space:nowrap;
    line-height:1.05;
}

/* bigger max for active */
.slot-unit.pos-active .word-span,
.slot-unit.pos-active .article-reveal{
    font-size: clamp(22px, 6.4vw, 48px);
}

/* previous readable */
.slot-unit.pos-prev .word-span,
.slot-unit.pos-prev .article-reveal{
    font-size: clamp(16px, 3.8vw, 28px);
}

/* next */
.slot-unit.pos-next .word-span,
.slot-unit.pos-next .article-reveal{
    font-size: clamp(14px, 3.2vw, 22px);
}

/* article should NOT affect centering until revealed */
.article-reveal{
    opacity:0;
    max-width:0;
    overflow:hidden;
    transition: opacity 220ms ease, max-width 260ms ease;
    margin-right:0;
}

/* when resolved, article appears and adds spacing */
.resolved .article-reveal{
    opacity:1;
    max-width: 140px;
    margin-right: 10px;
}

/* translation: not caps, more spacing, aligned with caption */
.sub-translation{
    margin-top: 12px;              /* more space from the word */
    font-weight: 650;
    letter-spacing: 0.02em;        /* no “shouting” */
    text-transform: none;          /* NO CAPS */
    color: rgba(231,236,255,0.68);
    font-size: 13px;
    line-height: 1.2;
    pointer-events:none;
}

/* show only on active, hide on prev/next/resolved */
.slot-unit.pos-prev .sub-translation,
.slot-unit.pos-next .sub-translation{ display:none !important; }
.resolved .sub-translation{ display:none !important; }

/* readability tweaks */
.slot-unit.pos-active{ text-shadow: 0 10px 24px rgba(0,0,0,0.65); }
.slot-unit.pos-prev{ opacity:0.82; filter: blur(0.35px); }
.slot-unit.pos-next{ opacity:0.45; filter: blur(1.2px); }

/* positions use vars (JS guarantees prev fits inside stage) */
.slot-unit.pos-next  { transform: translateY(var(--y-next)) scale(0.82); }
.slot-unit.pos-active{ transform: translateY(var(--y-active)) scale(1); filter: blur(0); }
.slot-unit.pos-prev  { transform: translateY(var(--y-prev)) scale(0.92); }
.slot-unit.pos-exit  { transform: translateY(var(--y-exit)) scale(0.6); opacity:0; filter: blur(0); }

/* shake uses active Y var */
.shake-active{ animation: shake 0.3s; }
@keyframes shake{
    0%, 100% { transform: translateY(var(--y-active)) translateX(0); }
    25%      { transform: translateY(var(--y-active)) translateX(-10px); }
    75%      { transform: translateY(var(--y-active)) translateX(10px); }
}

/* ===================================================================== */
/* MOBILE */
/* ===================================================================== */
@media (max-width: 768px){
    header{
        flex-direction:column;
        align-items:stretch;
        gap:8px;
        padding:8px 15px 10px;
        padding-top:max(8px, env(safe-area-inset-top));
    }

    .credits-top{ justify-content:flex-start; font-size:10px; }
    .header-row{ align-items:flex-start; }

    .app-title{
        font-size:18px;
        line-height:1.05;
        margin:0;
    }

    /* shorter stage (you asked), but still readable */
    .stage{
        height: clamp(260px, 38dvh, 360px);
        border-radius:22px;
    }

    .stage::before, .stage::after{ height: 55px; }

    .lang-toggle{
        width:32px; height:32px;
        border-radius:10px;
        font-size:17px;
    }

    .chip{ padding:5px 9px; font-size:12px; }

    .controls-area{ height: 82px; }
    .btn{ font-size:18px; }

    .btn.der{
        box-shadow: 0 0 12px rgba(75,139,255,0.55),
                    0 0 26px rgba(75,139,255,0.35),
                    0 4px 0 rgba(0,0,0,0.3);
    }
    .btn.die{
        box-shadow: 0 0 12px rgba(255,108,174,0.55),
                    0 0 26px rgba(255,108,174,0.35),
                    0 4px 0 rgba(0,0,0,0.3);
    }
    .btn.das{
        box-shadow: 0 0 12px rgba(255,216,75,0.55),
                    0 0 26px rgba(255,216,75,0.35),
                    0 4px 0 rgba(0,0,0,0.3);
    }
}

/* ===================================================================== */
/* DESKTOP ONLY */
/* ===================================================================== */
@media (min-width: 769px){
    header{ padding-left:0; padding-right:0; }
    header > *{
        max-width:1100px;
        margin:0 auto;
        padding-left:18px;
        padding-right:18px;
    }

    main{ max-width:1100px; padding-top:18px; }

    .game-hud, .controls-area, .stage-wrapper{
        width: var(--col-w);
        margin-left:auto;
        margin-right:auto;
    }

    .game-hud{
        max-width:720px;
        height:56px;
        padding:0 18px;
        border-radius:14px;
    }

    .stat-item{ min-width:140px; }
    .stat-item .label{ font-size:10px; letter-spacing:0.6px; }
    .stat-item .value{ font-size:20px; }

    .stage{ width: var(--stage-w); height:480px; }

    .controls-area{ gap:14px; height:90px; }
    .btn{ font-size:22px; border-radius:16px; padding:18px 0; }
}
