<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Slot Deutsch - Unified Motion</title>
    <style>
        :root {
            --bg: #0b1020;
            --card: #12192d;
            --muted: #a0aec0;
            --text: #e7ecff;
            --ok: #36c689;
            --bad: #ff6470;
            --der: #4b8bff;
            --die: #ff6cae;
            --das: #ffd84b;
            --border: #24335c;
        }

        * { box-sizing: border-box; }
        body {
            margin: 0; font-family: system-ui, -apple-system, sans-serif;
            background: radial-gradient(circle at top, #161d33 0%, #0b1020 100%);
            color: var(--text);
            min-height: 100vh; display: flex; flex-direction: column; align-items: center;
            overflow: hidden;
        }

        header { width: 100%; max-width: 900px; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .pill { background: #1a2340; border: 1px solid var(--border); color: var(--text); padding: 8px 16px; border-radius: 999px; font-size: 13px; cursor: pointer; }
        
        main { width: 100%; max-width: 900px; display: grid; grid-template-columns: 1fr 320px; gap: 24px; padding: 20px; }

        .stage {
            position: relative;
            height: 520px;
            background: #080c18;
            border-radius: 32px;
            border: 3px solid var(--border);
            overflow: hidden;
            box-shadow: inset 0 0 80px rgba(0,0,0,0.9);
        }

        .stage::before, .stage::after {
            content: ""; position: absolute; left: 0; right: 0; height: 120px; z-index: 10; pointer-events: none;
        }
        .stage::before { top: 0; background: linear-gradient(to bottom, #080c18 0%, transparent 100%); }
        .stage::after { bottom: 0; background: linear-gradient(to top, #080c18 0%, transparent 100%); }

        .reel-container { position: relative; width: 100%; height: 100%; }

        .slot-unit {
            position: absolute;
            left: 0; right: 0; height: 140px;
            display: flex; flex-direction: row; align-items: center; justify-content: center;
            transition: all 0.6s cubic-bezier(0.25, 1, 0.5, 1);
            font-weight: 800;
        }

        @keyframes shake {
            0%, 100% { transform: translateY(190px) translateX(0); }
            20%, 60% { transform: translateY(190px) translateX(-15px); }
            40%, 80% { transform: translateY(190px) translateX(15px); }
        }
        .shake-active { animation: shake 0.3s ease-in-out; }

        .slot-unit.pos-next { transform: translateY(20px) scale(0.95); filter: blur(1.5px) brightness(0.5); opacity: 0.5; }
        .slot-unit.pos-active { transform: translateY(190px) scale(1); filter: blur(0) brightness(1); opacity: 1; font-size: 52px; }
        /* Keep pos-prev large and clear enough to see the result */
        .slot-unit.pos-prev { transform: translateY(360px) scale(0.95); filter: blur(1.5px) brightness(0.7); opacity: 0.7; font-size: 40px; }
        .slot-unit.pos-exit { transform: translateY(550px) scale(0.8); opacity: 0; filter: blur(4px); }

        .article-reveal {
            opacity: 0;
            max-width: 0;
            display: inline-block;
            overflow: hidden;
            transition: opacity 0.3s ease, max-width 0.4s ease;
            white-space: nowrap;
            margin-right: 0;
            font-size: inherit;
        }

        /* Logic: once resolved, the article stays open permanently in all states */
        .resolved .article-reveal { 
            opacity: 1; 
            max-width: 200px; /* Large enough for 'einen' etc */
            margin-right: 15px;
        }

        .controls-area { margin-top: 30px; text-align: center; }
        .btnrow { display: flex; gap: 12px; justify-content: center; margin-bottom: 20px; }
        .btn {
            flex: 1; max-width: 120px; padding: 18px; border-radius: 20px; 
            border: 3px solid var(--border); background: #172142; color: #fff; 
            font-size: 18px; font-weight: 800; cursor: pointer; transition: 0.2s;
        }
        .btn.der:hover { border-color: var(--der); box-shadow: 0 0 15px var(--der); }
        .btn.die:hover { border-color: var(--die); box-shadow: 0 0 15px var(--die); }
        .btn.das:hover { border-color: var(--das); box-shadow: 0 0 15px var(--das); }

        .stat-box { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 20px; margin-bottom: 12px; }
        .stat-label { font-size: 11px; color: var(--muted); text-transform: uppercase; }
        .stat-value { font-size: 28px; font-weight: 800; margin-top: 5px; }
    </style>
</head>
<body>

<header>
    <h2 style="color:var(--accent); margin:0;">Slot <span style="font-weight: 300;">Deutsch</span></h2>
    <button class="pill" onclick="location.reload()">Reset All</button>
</header>

<main style="width:100%; max-width:900px; display:grid; grid-template-columns: 1fr 320px; gap:24px; padding:20px;">
    <section>
        <div class="stage">
            <div id="reel" class="reel-container"></div>
        </div>
        <div class="controls-area">
            <div class="btnrow">
                <button class="btn der" onclick="handleChoice('der')">der</button>
                <button class="btn die" onclick="handleChoice('die')">die</button>
                <button class="btn das" onclick="handleChoice('das')">das</button>
            </div>
        </div>
    </section>

    <aside>
        <div class="stat-box">
            <div class="stat-label">Correct / Wrong</div>
            <div class="stat-value"><span id="scoreOk" style="color:var(--ok)">0</span> / <span id="scoreBad" style="color:var(--bad)">0</span></div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Streak</div>
            <div class="stat-value" id="streak" style="color:var(--accent)">0</div>
        </div>
    </aside>
</main>

<script>
const wordData = [
    {word:"Adresse", article:"die"}, {word:"Angst", article:"die"}, {word:"Anzug", article:"der"},
    {word:"Apfel", article:"der"}, {word:"Arbeit", article:"die"}, {word:"Arzt", article:"der"},
    {word:"Auto", article:"das"}, {word:"Auge", article:"das"}, {word:"Bahnhof", article:"der"},
    {word:"Bett", article:"das"}, {word:"Bild", article:"das"}, {word:"Blume", article:"die"},
    {word:"Brot", article:"das"}, {word:"Bus", article:"der"}, {word:"Computer", article:"der"},
    {word:"Dorf", article:"das"}, {word:"Diskussion", article:"die"}, {word:"Erfolg", article:"der"},
    {word:"Familie", article:"die"}, {word:"Fenster", article:"das"}, {word:"Film", article:"der"},
    {word:"Firma", article:"die"}, {word:"Flugzeug", article:"das"}, {word:"Frage", article:"die"},
    {word:"Garten", article:"der"}, {word:"Geschenk", article:"das"}, {word:"Handy", article:"das"},
    {word:"Haus", article:"das"}, {word:"Idee", article:"die"}, {word:"Jahr", article:"das"},
    {word:"Kaffee", article:"der"}, {word:"Kind", article:"das"}, {word:"Kleidung", article:"die"},
    {word:"Lösung", article:"die"}, {word:"Mädchen", article:"das"}, {word:"Mann", article:"der"},
    {word:"Nachricht", article:"die"}, {word:"Obst", article:"das"}, {word:"Problem", article:"das"},
    {word:"Schlüssel", article:"der"}, {word:"Stadt", article:"die"}, {word:"Universität", article:"die"}
];

let currentIndex = 0;
let stats = { ok: 0, bad: 0, streak: 0 };
let isLock = false;
let activeUnit = null;
let prevUnit = null;

function init() {
    shuffle(wordData);
    spawnWord("pos-active"); 
    currentIndex++;
    spawnWord("pos-next");  
    updateScore();
}

function shuffle(a) {
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
}

function spawnWord(startPos) {
    const reel = document.getElementById('reel');
    const data = wordData[currentIndex % wordData.length];
    const unit = document.createElement('div');
    unit.className = `slot-unit ${startPos}`;
    unit.innerHTML = `<span class="article-reveal">${data.article}</span><span class="word-span">${data.word}</span>`;
    reel.appendChild(unit);
    if (startPos === "pos-active") activeUnit = unit;
    return unit;
}

function handleChoice(choice) {
    if (isLock) return;
    const currentData = wordData[(currentIndex - 1) % wordData.length];
    const correctArt = currentData.article;
    const isRight = choice === correctArt;

    if (!isRight) {
        activeUnit.classList.add('shake-active');
        setTimeout(() => activeUnit.classList.remove('shake-active'), 300);
        stats.bad++;
        stats.streak = 0;
        updateScore();
        return;
    }

    isLock = true;
    stats.ok++;
    stats.streak++;
    updateScore();

    // The 'resolved' class triggers the article to appear and color change
    activeUnit.classList.add('resolved');
    activeUnit.style.color = `var(--${correctArt})`;

    // Wait 0.9s so user sees the "locked" article before it slides down
    setTimeout(() => {
        const nextInLine = document.querySelector('.pos-next');
        
        if (prevUnit) {
            prevUnit.className = 'slot-unit pos-exit';
            const toDelete = prevUnit;
            setTimeout(() => toDelete.remove(), 700);
        }
        
        // This move is the key: pos-active -> pos-prev
        // Because 'resolved' remains on the classList, the article stays open!
        prevUnit = activeUnit;
        prevUnit.className = 'slot-unit pos-prev resolved'; 
        
        activeUnit = nextInLine;
        activeUnit.className = 'slot-unit pos-active';
        
        currentIndex++;
        spawnWord("pos-next");
        isLock = false;
    }, 900);
}

function updateScore() {
    document.getElementById('scoreOk').innerText = stats.ok;
    document.getElementById('scoreBad').innerText = stats.bad;
    document.getElementById('streak').innerText = stats.streak;
}

window.onkeydown = (e) => {
    const key = e.key.toLowerCase();
    if (key === 'a') handleChoice('der');
    if (key === 's') handleChoice('die');
    if (key === 'd') handleChoice('das');
};

init();
</script>
</body>
</html>
